# Nginx Configuration (YAML format for configuration management)
user: nginx
worker_processes: auto
error_log: /var/log/nginx/error.log warn
pid: /var/run/nginx.pid

events:
  worker_connections: 4096
  use: epoll
  multi_accept: on

http:
  include: /etc/nginx/mime.types
  default_type: application/octet-stream
  
  log_format: main |
    $remote_addr - $remote_user [$time_local] "$request"
    $status $body_bytes_sent "$http_referer"
    "$http_user_agent" "$http_x_forwarded_for"
  
  access_log: /var/log/nginx/access.log main
  
  sendfile: on
  tcp_nopush: on
  tcp_nodelay: on
  keepalive_timeout: 65
  types_hash_max_size: 2048
  client_max_body_size: 50M
  
  gzip: on
  gzip_vary: on
  gzip_proxied: any
  gzip_comp_level: 6
  gzip_types:
    - text/plain
    - text/css
    - text/xml
    - text/javascript
    - application/json
    - application/javascript
    - application/xml+rss
  
  upstream_backend:
    - server: backend1.example.com:8080 weight=3 max_fails=3 fail_timeout=30s
    - server: backend2.example.com:8080 weight=2
    - server: backend3.example.com:8080 backup
    keepalive: 32
  
  rate_limit_zones:
    - name: api_limit
      key: $binary_remote_addr
      size: 10m
      rate: 100r/s
  
  servers:
    - listen: 80
      server_name: example.com www.example.com
      return: 301 https://$server_name$request_uri
    
    - listen: 443 ssl http2
      server_name: example.com www.example.com
      
      ssl_certificate: /etc/nginx/ssl/cert.pem
      ssl_certificate_key: /etc/nginx/ssl/key.pem
      ssl_protocols: TLSv1.2 TLSv1.3
      ssl_ciphers: HIGH:!aNULL:!MD5
      ssl_prefer_server_ciphers: on
      ssl_session_cache: shared:SSL:10m
      ssl_session_timeout: 10m
      
      locations:
        - path: /
          root: /usr/share/nginx/html
          index: index.html index.htm
          try_files: $uri $uri/ /index.html
        
        - path: /api/
          proxy_pass: http://backend
          proxy_set_headers:
            Host: $host
            X-Real-IP: $remote_addr
            X-Forwarded-For: $proxy_add_x_forwarded_for
            X-Forwarded-Proto: $scheme
          proxy_connect_timeout: 30s
          proxy_send_timeout: 30s
          proxy_read_timeout: 30s
          limit_req:
            zone: api_limit
            burst: 20
            nodelay: true
