name: get_stdlib_functions_daemon_integration
description: Test get_stdlib_functions retrieves 600+ functions from daemon REST API instead of hardcoded 9 fallback
tags:
  - tools
  - get_stdlib_functions
  - daemon-integration
  - regression

sequence:
  - description: "Verify we get 600+ functions from daemon (not 9 from hardcoded fallback)"
    request:
      jsonrpc: "2.0"
      id: 31
      method: "tools/call"
      params:
        name: "get_stdlib_functions"
        arguments: {}
    expect:
      jsonrpc: "2.0"
      id: 31
      result:
        content:
          - type: "text"
            text: "{{JSON}}"
    # Note: The JSON content should parse to show count > 600
    # Manual verification: The response should contain 641 functions (as of Nov 2025)
    # not the 9 hardcoded functions (length, upper, lower, concat, size, map, filter, keys, values)

  - description: "Verify Math category has many functions (not limited to hardcoded set)"
    request:
      jsonrpc: "2.0"
      id: 32
      method: "tools/call"
      params:
        name: "get_stdlib_functions"
        arguments:
          category: "Math"
    expect:
      jsonrpc: "2.0"
      id: 32
      result:
        content:
          - type: "text"
            text: "{{JSON}}"
    # Math category should have 40+ functions from daemon
    # Hardcoded fallback has 0 Math functions

  - description: "Verify String category has 50+ functions from daemon"
    request:
      jsonrpc: "2.0"
      id: 33
      method: "tools/call"
      params:
        name: "get_stdlib_functions"
        arguments:
          category: "String"
    expect:
      jsonrpc: "2.0"
      id: 33
      result:
        content:
          - type: "text"
            text: "{{JSON}}"
    # String category should have 80+ functions from daemon
    # Hardcoded fallback only has 4 string functions (length, upper, lower, concat)

  - description: "Verify query filtering works across 600+ functions"
    request:
      jsonrpc: "2.0"
      id: 34
      method: "tools/call"
      params:
        name: "get_stdlib_functions"
        arguments:
          query: "encode"
    expect:
      jsonrpc: "2.0"
      id: 34
      result:
        content:
          - type: "text"
            text: "{{JSON}}"
    # Should find encoding-related functions from daemon
    # Hardcoded fallback has no "encode" functions
