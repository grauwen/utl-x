name: Infer Schema
description: Test schema inference via /api/infer-schema endpoint (positive and negative tests)
tags:
  - endpoints
  - infer-schema
  - schema

sequence:
  # Positive Tests - Valid UTLX should infer schema successfully
  - description: "✓ POSITIVE: Infer output schema from simple UTLX transformation"
    method: POST
    endpoint: /api/infer-schema
    headers:
      Content-Type: application/json
    body:
      utlx: "%utlx 1.0\ninput json\noutput json\n---\n{ name: $input.firstName, age: $input.age }"
      format: "json-schema"
    expect:
      status: 200
      body:
        success: true
        schema: "{{STRING}}"
        schemaFormat: "json-schema"

  - description: "✓ POSITIVE: Infer schema with input schema provided for better inference"
    method: POST
    endpoint: /api/infer-schema
    headers:
      Content-Type: application/json
    body:
      utlx: "%utlx 1.0\ninput json\noutput json\n---\n{ fullName: $input.firstName + \" \" + $input.lastName }"
      inputSchema: "{\"type\":\"object\",\"properties\":{\"firstName\":{\"type\":\"string\"},\"lastName\":{\"type\":\"string\"}}}"
      format: "json-schema"
    expect:
      status: 200
      body:
        success: true
        schema: "{{STRING}}"
        schemaFormat: "json-schema"

  # Negative Tests - Invalid UTLX should fail gracefully
  - description: "✗ NEGATIVE: Invalid UTLX syntax should return 400 with error"
    method: POST
    endpoint: /api/infer-schema
    headers:
      Content-Type: application/json
    body:
      utlx: "invalid @#$ syntax"
      format: "json-schema"
    expect:
      status: 400
      body:
        success: false
        error: "{{STRING}}"
