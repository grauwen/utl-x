name: "multi_input_json_yaml_to_json"
category: "multi-input"
description: "JSON and YAML inputs merged to JSON output - Deployment with configuration"
tags: ["multi-input", "json", "yaml", "devops", "kubernetes"]

inputs:
  deployments:
    format: json
    data: |
      {
        "deployments": [
          {
            "appId": "APP001",
            "name": "auth-service",
            "version": "v2.3.1",
            "replicas": 3,
            "namespace": "production"
          },
          {
            "appId": "APP002",
            "name": "payment-service",
            "version": "v1.5.0",
            "replicas": 5,
            "namespace": "production"
          }
        ]
      }

  helmconfig:
    format: yaml
    data: |
      applications:
        - appId: APP001
          resources:
            cpu: "500m"
            memory: "1Gi"
          environment:
            LOG_LEVEL: "info"
            DB_POOL_SIZE: "20"
          healthCheck:
            path: "/health"
            interval: 30
        - appId: APP002
          resources:
            cpu: "1000m"
            memory: "2Gi"
          environment:
            LOG_LEVEL: "warn"
            DB_POOL_SIZE: "50"
          healthCheck:
            path: "/healthz"
            interval: 15

transformation: |
  %utlx 1.0
  input: deployments json, helmconfig yaml
  output json
  ---
  {
    K8sManifests: {
      Source: "JSON+YAML",
      Applications: @deployments.deployments |> map(deploy => {
        let appId = deploy.appId;
        let config = @helmconfig.applications |> filter(app => app.appId == appId) |> first();

        AppID: appId,
        Name: deploy.name,
        Version: deploy.version,
        Replicas: deploy.replicas,
        Namespace: deploy.namespace,
        Resources: {
          CPU: config.resources.cpu,
          Memory: config.resources.memory
        },
        Environment: config.environment,
        HealthCheck: {
          Path: config.healthCheck.path,
          IntervalSeconds: config.healthCheck.interval
        }
      })
    }
  }

expected:
  format: json
  data: |
    {
      "K8sManifests": {
        "Source": "JSON+YAML",
        "Applications": [
          {
            "AppID": "APP001",
            "Name": "auth-service",
            "Version": "v2.3.1",
            "Replicas": 3,
            "Namespace": "production",
            "Resources": {
              "CPU": "500m",
              "Memory": "1Gi"
            },
            "Environment": {
              "LOG_LEVEL": "info",
              "DB_POOL_SIZE": "20"
            },
            "HealthCheck": {
              "Path": "/health",
              "IntervalSeconds": 30
            }
          },
          {
            "AppID": "APP002",
            "Name": "payment-service",
            "Version": "v1.5.0",
            "Replicas": 5,
            "Namespace": "production",
            "Resources": {
              "CPU": "1000m",
              "Memory": "2Gi"
            },
            "Environment": {
              "LOG_LEVEL": "warn",
              "DB_POOL_SIZE": "50"
            },
            "HealthCheck": {
              "Path": "/healthz",
              "IntervalSeconds": 15
            }
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "Kubernetes/Helm deployments"
  notes:
    - "Deployment manifest (JSON) + Helm config (YAML)"
    - "Common DevOps pattern"
    - "Merging deployment info with resource configs"
