name: "sum_auto_a4eced76"
category: "stdlib/array"
description: "Auto-captured test for sum"
tags: ["auto-generated", "sum", "sum", "map", "now"]
auto_generated: true
captured_at: "2025-10-19T13:42:37.834961Z"

input:
  format: json
  data: |
    <?xml version="1.0" encoding="ISO-8859-1"?>
    <SAP_Response>
      <Material>
        <MaterialNumber>MAT-001</MaterialNumber>
        <Description>Stahl RÃ¶hre 100mm</Description>
        <Price>125.50</Price>
        <Currency>EUR</Currency>
        <Availability>
          <Warehouse>WH01</Warehouse>
          <Stock>150</Stock>
          <Reserved>25</Reserved>
        </Availability>
        <Availability>
          <Warehouse>WH02</Warehouse>
          <Stock>75</Stock>
          <Reserved>10</Reserved>
        </Availability>
      </Material>
    </SAP_Response>
    

transformation: |
  %utlx 1.0
  input xml {encoding: "auto"}
  output json
  ---
  let material = $input.SAP_Response.Material
  let totalStock = sum(map(material.Availability, avail => toNumber(avail.Stock)))
  let totalReserved = sum(map(material.Availability, avail => toNumber(avail.Reserved)))
  let availableStock = totalStock - totalReserved
  
  {
    product: {
      sku: material.MaterialNumber,
      name: material.Description,
      price: {
        amount: toNumber(material.Price),
        currency: material.Currency
      },
      inventory: {
        total_stock: totalStock,
        reserved: totalReserved,
        available: availableStock,
        status: if (availableStock > 50) "IN_STOCK" 
               else if (availableStock > 0) "LOW_STOCK" 
               else "OUT_OF_STOCK",
        warehouses: map(material.Availability, avail => {
          id: avail.Warehouse,
          stock: toNumber(avail.Stock),
          reserved: toNumber(avail.Reserved),
          available: toNumber(avail.Stock) - toNumber(avail.Reserved)
        })
      }
    },
    metadata: {
      source: "SAP",
      encoding_detected: detectXMLEncoding($input),
      processed_at: now(),
      total_locations: count(material.Availability)
    }
  }
  

known_issue:
  status: "failing"
  captured_output: "Cannot access property 'Material' on NullValue"
  issue_description: "Cannot access property 'Material' on NullValue"
  captured_at: "2025-10-19T13:42:37.835088Z"

performance_limits:
  max_duration_ms: 96
  max_memory_mb: 10

metadata:
  author: "UTL-X Auto-Capture"
  captured_date: "2025-10-19"
  references: ["Auto-generated test case"]
