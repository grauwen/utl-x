name: "multi_input_json_json_to_json"
category: "multi-input"
description: "Two JSON inputs merged to JSON output - User profiles with activity data"
tags: ["multi-input", "json", "api", "integration"]

inputs:
  profiles:
    format: json
    data: |
      {
        "users": [
          {
            "userId": "U001",
            "name": "Emma Wilson",
            "email": "emma@example.com",
            "role": "Admin"
          },
          {
            "userId": "U002",
            "name": "James Brown",
            "email": "james@example.com",
            "role": "User"
          }
        ]
      }

  activity:
    format: json
    data: |
      {
        "userActivity": [
          {
            "userId": "U001",
            "lastLogin": "2025-10-21T10:30:00Z",
            "loginCount": 145,
            "documentsCreated": 23
          },
          {
            "userId": "U002",
            "lastLogin": "2025-10-20T15:45:00Z",
            "loginCount": 67,
            "documentsCreated": 12
          }
        ]
      }

transformation: |
  %utlx 1.0
  input: profiles json, activity json
  output json
  ---
  {
    UserReport: {
      Source: "JSON+JSON",
      Users: @profiles.users |> map(user => {
        let userId = user.userId
        let act = @activity.userActivity |> filter(a => a.userId == userId) |> first()

        UserID: userId,
        Name: user.name,
        Email: user.email,
        Role: user.role,
        Activity: {
          LastLogin: act.lastLogin,
          LoginCount: act.loginCount,
          DocumentsCreated: act.documentsCreated,
          AverageDocsPerLogin: act.documentsCreated / act.loginCount
        },
        ActiveUser: act.loginCount > 100
      })
    }
  }

expected:
  format: json
  data: |
    {
      "UserReport": {
        "Source": "JSON+JSON",
        "Users": [
          {
            "UserID": "U001",
            "Name": "Emma Wilson",
            "Email": "emma@example.com",
            "Role": "Admin",
            "Activity": {
              "LastLogin": "2025-10-21T10:30:00Z",
              "LoginCount": 145,
              "DocumentsCreated": 23,
              "AverageDocsPerLogin": 0.1586206896551724
            },
            "ActiveUser": true
          },
          {
            "UserID": "U002",
            "Name": "James Brown",
            "Email": "james@example.com",
            "Role": "User",
            "Activity": {
              "LastLogin": "2025-10-20T15:45:00Z",
              "LoginCount": 67,
              "DocumentsCreated": 12,
              "AverageDocsPerLogin": 0.17910447761194032
            },
            "ActiveUser": false
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "JSON API integration"
  notes:
    - "Both inputs from REST APIs (JSON)"
    - "User profiles + Activity tracking"
    - "Calculated metrics (average docs per login)"
