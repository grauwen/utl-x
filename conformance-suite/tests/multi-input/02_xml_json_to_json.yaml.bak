name: "multi_input_xml_json_to_json"
category: "multi-input"
description: "XML and JSON inputs merged to JSON output - Product catalog with pricing"
tags: ["multi-input", "xml", "json", "integration", "sap"]

inputs:
  products:
    format: xml
    data: |
      <?xml version="1.0" encoding="ISO-8859-1"?>
      <Products>
        <Product sku="SKU001">
          <Name>Müller Widget</Name>
          <Category>Tools</Category>
          <InStock>true</InStock>
        </Product>
        <Product sku="SKU002">
          <Name>Schröder Gadget</Name>
          <Category>Electronics</Category>
          <InStock>true</InStock>
        </Product>
      </Products>

  pricing:
    format: json
    data: |
      {
        "prices": [
          {
            "sku": "SKU001",
            "price": 29.99,
            "currency": "EUR",
            "discount": 0.10
          },
          {
            "sku": "SKU002",
            "price": 149.99,
            "currency": "EUR",
            "discount": 0.05
          }
        ]
      }

transformation: |
  %utlx 1.0
  input: products xml, pricing json
  output json
  ---
  {
    Catalog: {
      Source: "XML+JSON",
      Items: @products.Products.Product |> map(product => {
        let sku = product.@sku
        let priceData = @pricing.prices |> filter(p => p.sku == sku) |> first()

        SKU: sku,
        Name: product.Name,
        Category: product.Category,
        InStock: product.InStock == "true",
        Price: priceData.price,
        Currency: priceData.currency,
        DiscountPercent: priceData.discount * 100,
        FinalPrice: priceData.price * (1 - priceData.discount)
      })
    }
  }

expected:
  format: json
  data: |
    {
      "Catalog": {
        "Source": "XML+JSON",
        "Items": [
          {
            "SKU": "SKU001",
            "Name": "Müller Widget",
            "Category": "Tools",
            "InStock": true,
            "Price": 29.99,
            "Currency": "EUR",
            "DiscountPercent": 10,
            "FinalPrice": 26.991
          },
          {
            "SKU": "SKU002",
            "Name": "Schröder Gadget",
            "Category": "Electronics",
            "InStock": true,
            "Price": 149.99,
            "Currency": "EUR",
            "DiscountPercent": 5,
            "FinalPrice": 142.4905
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "XML from SAP (ISO-8859-1) + JSON from REST API"
  notes:
    - "Common enterprise pattern: SAP XML + REST API JSON"
    - "Demonstrates encoding handling (German characters)"
    - "Price calculation with discount"
