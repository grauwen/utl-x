name: "multi_input_csv_yaml_to_json"
category: "multi-input"
description: "CSV and YAML inputs merged to JSON output - Servers with monitoring config"
tags: ["multi-input", "csv", "yaml", "json", "infrastructure"]

inputs:
  servers:
    format: csv
    data: |
      ServerID,Hostname,IPAddress,Region,Status
      SRV001,web-server-01,192.168.1.10,US-East,Active
      SRV002,db-server-01,192.168.1.20,US-West,Active
      SRV003,cache-server-01,192.168.1.30,EU-Central,Active

  monitoring:
    format: yaml
    data: |
      monitoringConfig:
        - serverId: SRV001
          alerts:
            - type: cpu
              threshold: 80
            - type: memory
              threshold: 85
          checkInterval: 60
          owner: ops-team
        - serverId: SRV002
          alerts:
            - type: cpu
              threshold: 70
            - type: memory
              threshold: 90
            - type: disk
              threshold: 85
          checkInterval: 30
          owner: db-team
        - serverId: SRV003
          alerts:
            - type: cpu
              threshold: 75
            - type: memory
              threshold: 80
          checkInterval: 45
          owner: cache-team

transformation: |
  %utlx 1.0
  input: servers csv {headers: true}, monitoring yaml
  output json
  ---
  {
    InfrastructureMonitoring: {
      Source: "CSV+YAML",
      Servers: @servers.rows |> map(server => {
        let serverId = server.ServerID
        let monConfig = @monitoring.monitoringConfig |> filter(m => m.serverId == serverId) |> first()

        ServerID: serverId,
        Hostname: server.Hostname,
        IPAddress: server.IPAddress,
        Region: server.Region,
        Status: server.Status,
        Monitoring: {
          Owner: monConfig.owner,
          CheckIntervalSeconds: monConfig.checkInterval,
          Alerts: monConfig.alerts |> map(alert => {
            Type: alert.type,
            ThresholdPercent: alert.threshold
          }),
          AlertCount: count(monConfig.alerts)
        }
      })
    }
  }

expected:
  format: json
  data: |
    {
      "InfrastructureMonitoring": {
        "Source": "CSV+YAML",
        "Servers": [
          {
            "ServerID": "SRV001",
            "Hostname": "web-server-01",
            "IPAddress": "192.168.1.10",
            "Region": "US-East",
            "Status": "Active",
            "Monitoring": {
              "Owner": "ops-team",
              "CheckIntervalSeconds": 60,
              "Alerts": [
                {
                  "Type": "cpu",
                  "ThresholdPercent": 80
                },
                {
                  "Type": "memory",
                  "ThresholdPercent": 85
                }
              ],
              "AlertCount": 2
            }
          },
          {
            "ServerID": "SRV002",
            "Hostname": "db-server-01",
            "IPAddress": "192.168.1.20",
            "Region": "US-West",
            "Status": "Active",
            "Monitoring": {
              "Owner": "db-team",
              "CheckIntervalSeconds": 30,
              "Alerts": [
                {
                  "Type": "cpu",
                  "ThresholdPercent": 70
                },
                {
                  "Type": "memory",
                  "ThresholdPercent": 90
                },
                {
                  "Type": "disk",
                  "ThresholdPercent": 85
                }
              ],
              "AlertCount": 3
            }
          },
          {
            "ServerID": "SRV003",
            "Hostname": "cache-server-01",
            "IPAddress": "192.168.1.30",
            "Region": "EU-Central",
            "Status": "Active",
            "Monitoring": {
              "Owner": "cache-team",
              "CheckIntervalSeconds": 45,
              "Alerts": [
                {
                  "Type": "cpu",
                  "ThresholdPercent": 75
                },
                {
                  "Type": "memory",
                  "ThresholdPercent": 80
                }
              ],
              "AlertCount": 2
            }
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "Infrastructure monitoring"
  notes:
    - "Server inventory (CSV) + Monitoring config (YAML)"
    - "Common DevOps/SRE pattern"
    - "Alert configuration per server"
