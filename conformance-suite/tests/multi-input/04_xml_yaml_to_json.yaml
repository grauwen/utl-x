name: "multi_input_xml_yaml_to_json"
category: "multi-input"
description: "XML and YAML inputs merged to JSON output - Services with configuration"
tags: ["multi-input", "xml", "yaml", "json", "config"]

inputs:
  services:
    format: xml
    data: |
      <?xml version="1.0" encoding="UTF-8"?>
      <Services>
        <Service id="SVC001">
          <Name>Authentication</Name>
          <Endpoint>/api/auth</Endpoint>
          <Status>Active</Status>
        </Service>
        <Service id="SVC002">
          <Name>Payment</Name>
          <Endpoint>/api/payment</Endpoint>
          <Status>Active</Status>
        </Service>
      </Services>

  config:
    format: yaml
    data: |
      configurations:
        - serviceId: SVC001
          timeout: 5000
          retryCount: 3
          rateLimit: 100
          environment: production
        - serviceId: SVC002
          timeout: 10000
          retryCount: 5
          rateLimit: 50
          environment: production

transformation: |
  %utlx 1.0
  input: services xml, config yaml
  output json
  ---
  {
    ServiceConfiguration: {
      Source: "XML+YAML",
      Services: @services.Services.Service |> map(service => {
        let serviceId = service.@id
        let cfg = @config.configurations |> filter(c => c.serviceId == serviceId) |> first()

        ServiceID: serviceId,
        Name: service.Name,
        Endpoint: service.Endpoint,
        Status: service.Status,
        Configuration: {
          Timeout: cfg.timeout,
          RetryCount: cfg.retryCount,
          RateLimit: cfg.rateLimit,
          Environment: cfg.environment
        }
      })
    }
  }

expected:
  format: json
  data: |
    {
      "ServiceConfiguration": {
        "Source": "XML+YAML",
        "Services": [
          {
            "ServiceID": "SVC001",
            "Name": "Authentication",
            "Endpoint": "/api/auth",
            "Status": "Active",
            "Configuration": {
              "Timeout": 5000,
              "RetryCount": 3,
              "RateLimit": 100,
              "Environment": "production"
            }
          },
          {
            "ServiceID": "SVC002",
            "Name": "Payment",
            "Endpoint": "/api/payment",
            "Status": "Active",
            "Configuration": {
              "Timeout": 10000,
              "RetryCount": 5,
              "RateLimit": 50,
              "Environment": "production"
            }
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "YAML configuration files"
  notes:
    - "Service definitions (XML) + Configuration (YAML)"
    - "Common microservices pattern"
    - "YAML for config, XML for service catalog"
