name: "multi_input_xml_json_to_xml"
category: "multi-input"
description: "XML and JSON inputs merged to XML output - SAP Products with REST API pricing"
tags: ["multi-input", "xml", "json", "sap", "integration"]

inputs:
  products:
    format: xml
    data: |
      <?xml version="1.0" encoding="ISO-8859-1"?>
      <Products>
        <Product id="P001">
          <Name>Müller Widget Pro</Name>
          <Category>Hardware</Category>
          <SKU>MWP-2025</SKU>
        </Product>
        <Product id="P002">
          <Name>Schröder Gadget Plus</Name>
          <Category>Electronics</Category>
          <SKU>SGP-2025</SKU>
        </Product>
        <Product id="P003">
          <Name>König Tool Set</Name>
          <Category>Tools</Category>
          <SKU>KTS-2025</SKU>
        </Product>
      </Products>

  pricing:
    format: json
    data: |
      {
        "prices": [
          {
            "productId": "P001",
            "currency": "EUR",
            "listPrice": 299.99,
            "discountPrice": 249.99,
            "effectiveDate": "2025-10-01"
          },
          {
            "productId": "P002",
            "currency": "EUR",
            "listPrice": 449.99,
            "discountPrice": 399.99,
            "effectiveDate": "2025-10-01"
          },
          {
            "productId": "P003",
            "currency": "EUR",
            "listPrice": 159.99,
            "discountPrice": 139.99,
            "effectiveDate": "2025-10-01"
          }
        ]
      }

transformation: |
  %utlx 1.0
  input: products xml, pricing json
  output xml {encoding: "UTF-8"}
  ---
  {
    ProductCatalog: {
      @generatedDate: "2025-10-21",
      @sourceSystems: "SAP+REST-API",
      SourceInfo: {
        ProductsEncoding: detectXMLEncoding(@products),
        PricingFormat: "JSON"
      },
      Products: @products.Products.Product |> map(product => {
        let prodId = product.@id
        let price = @pricing.prices |> filter(p => p.productId == prodId) |> first()

        Product: {
          @id: prodId,
          @sku: product.SKU,
          Name: product.Name,
          Category: product.Category,
          Pricing: {
            @currency: price.currency,
            ListPrice: price.listPrice,
            DiscountPrice: price.discountPrice,
            DiscountPercent: round(((price.listPrice - price.discountPrice) / price.listPrice) * 100),
            EffectiveDate: price.effectiveDate
          }
        }
      })
    }
  }

expected:
  format: xml
  data: |
    <?xml version="1.0" encoding="UTF-8"?>
    <ProductCatalog generatedDate="2025-10-21" sourceSystems="SAP+REST-API">
      <SourceInfo>
        <ProductsEncoding>ISO-8859-1</ProductsEncoding>
        <PricingFormat>JSON</PricingFormat>
      </SourceInfo>
      <Products>
        <Product id="P001" sku="MWP-2025">
          <Name>Müller Widget Pro</Name>
          <Category>Hardware</Category>
          <Pricing currency="EUR">
            <ListPrice>299.99</ListPrice>
            <DiscountPrice>249.99</DiscountPrice>
            <DiscountPercent>17</DiscountPercent>
            <EffectiveDate>2025-10-01</EffectiveDate>
          </Pricing>
        </Product>
        <Product id="P002" sku="SGP-2025">
          <Name>Schröder Gadget Plus</Name>
          <Category>Electronics</Category>
          <Pricing currency="EUR">
            <ListPrice>449.99</ListPrice>
            <DiscountPrice>399.99</DiscountPrice>
            <DiscountPercent>11</DiscountPercent>
            <EffectiveDate>2025-10-01</EffectiveDate>
          </Pricing>
        </Product>
        <Product id="P003" sku="KTS-2025">
          <Name>König Tool Set</Name>
          <Category>Tools</Category>
          <Pricing currency="EUR">
            <ListPrice>159.99</ListPrice>
            <DiscountPrice>139.99</DiscountPrice>
            <DiscountPercent>13</DiscountPercent>
            <EffectiveDate>2025-10-01</EffectiveDate>
          </Pricing>
        </Product>
      </Products>
    </ProductCatalog>

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "XML to XML transformation"
    - "SAP integration with REST API"
  notes:
    - "XML (ISO-8859-1) + JSON → XML (UTF-8)"
    - "SAP product catalog enriched with pricing API"
    - "German characters preserved (Müller, Schröder, König)"
    - "Discount percentage calculation"
