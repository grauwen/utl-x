name: "multi_input_csv_csv_to_csv"
category: "multi-input"
description: "Two CSV inputs merged to CSV output - Employee and Department HR report"
tags: ["multi-input", "csv", "hr", "reporting"]

inputs:
  employees:
    format: csv
    data: |
      EmployeeID,Name,DeptID,Salary,HireDate,Email
      E001,Alice Müller,D001,75000,2020-03-15,alice.mueller@company.de
      E002,Bob Schneider,D002,82000,2019-07-01,bob.schneider@company.de
      E003,Carol Fischer,D001,68000,2021-01-10,carol.fischer@company.de
      E004,David König,D003,95000,2018-11-20,david.koenig@company.de
      E005,Eva Wagner,D002,71000,2022-05-12,eva.wagner@company.de

  departments:
    format: csv
    data: |
      DeptID,DepartmentName,Location,Manager,Budget
      D001,Engineering,München,Hans Schmidt,500000
      D002,Sales,Berlin,Maria Weber,300000
      D003,Management,Hamburg,Klaus Becker,400000

transformation: |
  %utlx 1.0
  input: employees csv {headers: true}, departments csv {headers: true}
  output csv {headers: true}
  ---
  {
    headers: [
      "EmployeeID",
      "EmployeeName",
      "Email",
      "DepartmentName",
      "Location",
      "Manager",
      "Salary",
      "HireDate",
      "BudgetAllocation"
    ],
    rows: @employees |> map(emp => {
      let deptId = emp.DeptID;
      let dept = @departments |> filter(d => d.DeptID == deptId) |> first();
      let salary = parseNumber(emp.Salary);
      let budget = parseNumber(dept.Budget);

      [
        emp.EmployeeID,
        emp.Name,
        emp.Email,
        dept.DepartmentName,
        dept.Location,
        dept.Manager,
        salary,
        emp.HireDate,
        round((salary / budget) * 100, 2)
      ]
    })
  }

expected:
  format: csv
  data: |
    EmployeeID,EmployeeName,Email,DepartmentName,Location,Manager,Salary,HireDate,BudgetAllocation
    E001,Alice Müller,alice.mueller@company.de,Engineering,München,Hans Schmidt,75000,2020-03-15,15
    E002,Bob Schneider,bob.schneider@company.de,Sales,Berlin,Maria Weber,82000,2019-07-01,27
    E003,Carol Fischer,carol.fischer@company.de,Engineering,München,Hans Schmidt,68000,2021-01-10,14
    E004,David König,david.koenig@company.de,Management,Hamburg,Klaus Becker,95000,2018-11-20,24
    E005,Eva Wagner,eva.wagner@company.de,Sales,Berlin,Maria Weber,71000,2022-05-12,24

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "CSV to CSV transformation"
    - "HR data integration"
  notes:
    - "CSV + CSV → CSV (flat output)"
    - "Employee master + Department master"
    - "Calculated field: budget allocation percentage"
    - "German characters preserved (Müller, Schneider, König)"
