name: "multi_input_xml_csv_to_json"
category: "multi-input"
description: "XML and CSV inputs merged to JSON output - Products with inventory"
tags: ["multi-input", "xml", "csv", "json", "inventory"]

inputs:
  products:
    format: xml
    data: |
      <?xml version="1.0" encoding="UTF-8"?>
      <Products>
        <Product id="P001">
          <Name>Laptop</Name>
          <Category>Electronics</Category>
        </Product>
        <Product id="P002">
          <Name>Mouse</Name>
          <Category>Accessories</Category>
        </Product>
        <Product id="P003">
          <Name>Keyboard</Name>
          <Category>Accessories</Category>
        </Product>
      </Products>

  inventory:
    format: csv
    data: |
      ProductID,Warehouse,Quantity,LastUpdated
      P001,WH-NORTH,45,2025-10-20
      P002,WH-NORTH,120,2025-10-21
      P003,WH-SOUTH,67,2025-10-19

transformation: |
  %utlx 1.0
  input: products xml, inventory csv {headers: true}
  output json
  ---
  {
    InventoryReport: {
      Source: "XML+CSV",
      Items: @products.Products.Product |> map(product => {
        let productId = product.@id;
        let stock = @inventory |> filter(row => row.ProductID == productId) |> first();

        ProductID: productId,
        Name: product.Name,
        Category: product.Category,
        Warehouse: stock.Warehouse,
        QuantityInStock: parseNumber(stock.Quantity),
        LastUpdated: stock.LastUpdated,
        StockStatus: if (parseNumber(stock.Quantity) > 100) "High"
                     else if (parseNumber(stock.Quantity) > 50) "Medium"
                     else "Low"
      })
    }
  }

expected:
  format: json
  data: |
    {
      "InventoryReport": {
        "Source": "XML+CSV",
        "Items": [
          {
            "ProductID": "P001",
            "Name": "Laptop",
            "Category": "Electronics",
            "Warehouse": "WH-NORTH",
            "QuantityInStock": 45,
            "LastUpdated": "2025-10-20",
            "StockStatus": "Low"
          },
          {
            "ProductID": "P002",
            "Name": "Mouse",
            "Category": "Accessories",
            "Warehouse": "WH-NORTH",
            "QuantityInStock": 120,
            "LastUpdated": "2025-10-21",
            "StockStatus": "High"
          },
          {
            "ProductID": "P003",
            "Name": "Keyboard",
            "Category": "Accessories",
            "Warehouse": "WH-SOUTH",
            "QuantityInStock": 67,
            "LastUpdated": "2025-10-19",
            "StockStatus": "Medium"
          }
        ]
      }
    }

performance_limits:
  max_duration_ms: 200
  max_memory_mb: 20

metadata:
  author: "UTL-X Team"
  created_date: "2025-10-21"
  references:
    - "Multiple inputs feature"
    - "CSV parsing with headers"
  notes:
    - "Product master data (XML) + Warehouse inventory (CSV)"
    - "CSV headers automatically parsed"
    - "Stock status calculation based on quantity"
